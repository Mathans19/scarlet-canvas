{% extends "base.html" %}

{% block title %}Clean Data - WANDA Analytics{% endblock %}
{% block nav_clean %}active{% endblock %}

{% block content %}
<div class="container">
  <!-- Header -->
  <div style="margin-bottom: 3rem;">
    <h1 style="font-size: 2.5rem; font-weight: bold; margin-bottom: 1rem;">
      <span class="gradient-text text-glow">Reality Manipulation</span>
    </h1>
    <p style="color: hsl(var(--muted-foreground)); font-family: Inter, sans-serif; max-width: 36rem;">
      Reshape your data with chaos magic. Transform, cleanse, and 
      transmute your dataset into its purest form.
    </p>
  </div>

  <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 2rem;">
    <!-- Operations Panel -->
    <div>
      <div class="glass-card tilt-card" data-intensity="5" style="padding: 1.5rem; position: sticky; top: 7rem;">
        <div class="glow-overlay"></div>
        <h2 style="font-family: Cinzel, serif; font-size: 1.25rem; color: hsl(var(--foreground)); margin-bottom: 1.5rem;">Transformation Spells</h2>
        
        <div id="operationsList" style="display: flex; flex-direction: column; gap: 0.75rem; margin-bottom: 1.5rem;">
          <!-- Populated by JS -->
        </div>

        <button id="applyBtn" class="magic-btn primary md" style="width: 100%;" disabled>
          <span class="shimmer"></span>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z"/>
            <path d="m14 7 3 3"/><path d="M5 6v4"/><path d="M19 14v4"/><path d="M10 2v2"/><path d="M7 8H3"/><path d="M21 16h-4"/><path d="M11 3H9"/>
          </svg>
          <span id="applyBtnText">Apply Transformation</span>
        </button>
      </div>
    </div>

    <!-- Data Table -->
    <div>
      <div class="glass-card tilt-card" data-intensity="3" style="padding: 1.5rem; overflow: hidden;">
        <div class="glow-overlay"></div>
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem;">
          <h2 style="font-family: Cinzel, serif; font-size: 1.25rem; color: hsl(var(--foreground));">Data Preview</h2>
          <span style="font-family: Inter, sans-serif; font-size: 0.875rem; color: hsl(var(--muted-foreground));">
            6 rows â€¢ 6 columns
          </span>
        </div>

        <div style="overflow-x: auto;">
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="border-bottom: 1px solid hsl(var(--border));">
                <th style="text-align: left; padding: 0.75rem 1rem; font-family: Inter, sans-serif; font-size: 0.75rem; color: hsl(var(--muted-foreground)); font-weight: 500; text-transform: uppercase; letter-spacing: 0.05em;">ID</th>
                <th style="text-align: left; padding: 0.75rem 1rem; font-family: Inter, sans-serif; font-size: 0.75rem; color: hsl(var(--muted-foreground)); font-weight: 500; text-transform: uppercase; letter-spacing: 0.05em;">Name</th>
                <th style="text-align: left; padding: 0.75rem 1rem; font-family: Inter, sans-serif; font-size: 0.75rem; color: hsl(var(--muted-foreground)); font-weight: 500; text-transform: uppercase; letter-spacing: 0.05em;">Email</th>
                <th style="text-align: left; padding: 0.75rem 1rem; font-family: Inter, sans-serif; font-size: 0.75rem; color: hsl(var(--muted-foreground)); font-weight: 500; text-transform: uppercase; letter-spacing: 0.05em;">Age</th>
                <th style="text-align: left; padding: 0.75rem 1rem; font-family: Inter, sans-serif; font-size: 0.75rem; color: hsl(var(--muted-foreground)); font-weight: 500; text-transform: uppercase; letter-spacing: 0.05em;">Score</th>
                <th style="text-align: left; padding: 0.75rem 1rem; font-family: Inter, sans-serif; font-size: 0.75rem; color: hsl(var(--muted-foreground)); font-weight: 500; text-transform: uppercase; letter-spacing: 0.05em;">Status</th>
              </tr>
            </thead>
            <tbody id="dataTable">
              <!-- Populated by JS -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Quick Stats -->
      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 1.5rem;">
        <div class="glass-card tilt-card" data-intensity="10" style="padding: 1rem; text-align: center;">
          <div class="glow-overlay"></div>
          <p style="font-family: Cinzel, serif; font-size: 1.5rem; color: hsl(var(--scarlet));">4</p>
          <p style="font-family: Inter, sans-serif; font-size: 0.75rem; color: hsl(var(--muted-foreground));">Null Values</p>
        </div>
        <div class="glass-card tilt-card" data-intensity="10" style="padding: 1rem; text-align: center;">
          <div class="glow-overlay"></div>
          <p style="font-family: Cinzel, serif; font-size: 1.5rem; color: hsl(142, 76%, 56%);">0</p>
          <p style="font-family: Inter, sans-serif; font-size: 0.75rem; color: hsl(var(--muted-foreground));">Duplicates</p>
        </div>
        <div class="glass-card tilt-card" data-intensity="10" style="padding: 1rem; text-align: center;">
          <div class="glow-overlay"></div>
          <p style="font-family: Cinzel, serif; font-size: 1.5rem; color: hsl(45, 93%, 58%);">2</p>
          <p style="font-family: Inter, sans-serif; font-size: 0.75rem; color: hsl(var(--muted-foreground));">Outliers</p>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  @media (max-width: 1024px) {
    .container > div:last-child { grid-template-columns: 1fr; }
  }
</style>

<script>
  // Sample data
  const sampleData = [
    { id: 1, name: "John Doe", email: "john@email.com", age: 28, score: 85.5, status: "active" },
    { id: 2, name: "Jane Smith", email: "jane@email.com", age: null, score: 92.3, status: "active" },
    { id: 3, name: "Bob Wilson", email: null, age: 35, score: 78.1, status: "inactive" },
    { id: 4, name: "Alice Brown", email: "alice@email.com", age: 42, score: null, status: "active" },
    { id: 5, name: "Charlie Davis", email: "charlie@email.com", age: 31, score: 88.9, status: "pending" },
    { id: 6, name: null, email: "unknown@email.com", age: 29, score: 76.4, status: "active" },
  ];

  const operations = [
    { id: "remove-nulls", label: "Remove Null Values", icon: "trash", description: "Eliminate rows with missing data" },
    { id: "fill-mean", label: "Fill with Mean", icon: "wand", description: "Replace nulls with column average" },
    { id: "normalize", label: "Normalize Data", icon: "arrows", description: "Scale values between 0 and 1" },
    { id: "filter-outliers", label: "Remove Outliers", icon: "filter", description: "Exclude statistical anomalies" },
  ];

  const icons = {
    trash: '<path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>',
    wand: '<path d="m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z"/><path d="m14 7 3 3"/>',
    arrows: '<path d="m3 16 4 4 4-4"/><path d="M7 20V4"/><path d="m21 8-4-4-4 4"/><path d="M17 4v16"/>',
    filter: '<polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>',
  };

  let selectedOp = null;
  let isProcessing = false;
  let processedRows = [];

  // Populate operations
  const opsList = document.getElementById('operationsList');
  operations.forEach(op => {
    const btn = document.createElement('button');
    btn.id = `op-${op.id}`;
    btn.style.cssText = 'width: 100%; padding: 1rem; border-radius: 8px; text-align: left; transition: all 0.3s; display: flex; align-items: flex-start; gap: 0.75rem; background: hsl(var(--muted) / 0.3); border: 1px solid transparent; cursor: pointer;';
    btn.innerHTML = `
      <div style="width: 2.5rem; height: 2.5rem; border-radius: 8px; display: flex; align-items: center; justify-content: center; transition: all 0.3s; background: hsl(var(--muted));">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="hsl(var(--muted-foreground))" stroke-width="2">${icons[op.icon]}</svg>
      </div>
      <div>
        <p style="font-family: Inter, sans-serif; font-size: 0.875rem; font-weight: 500; color: hsl(var(--muted-foreground)); transition: color 0.3s;">${op.label}</p>
        <p style="font-family: Inter, sans-serif; font-size: 0.75rem; color: hsl(var(--muted-foreground)); margin-top: 0.25rem;">${op.description}</p>
      </div>
    `;
    
    btn.onclick = () => {
      selectedOp = op.id;
      document.querySelectorAll('#operationsList button').forEach(b => {
        b.style.background = 'hsl(var(--muted) / 0.3)';
        b.style.borderColor = 'transparent';
        b.style.boxShadow = 'none';
        b.querySelector('div').style.background = 'hsl(var(--muted))';
        b.querySelector('svg').style.stroke = 'hsl(var(--muted-foreground))';
        b.querySelector('p').style.color = 'hsl(var(--muted-foreground))';
      });
      btn.style.background = 'hsl(var(--scarlet-dark) / 0.3)';
      btn.style.borderColor = 'hsl(var(--scarlet) / 0.5)';
      btn.style.boxShadow = 'var(--glow-sm)';
      btn.querySelector('div').style.background = 'hsl(var(--scarlet) / 0.2)';
      btn.querySelector('svg').style.stroke = 'hsl(var(--scarlet))';
      btn.querySelector('p').style.color = 'hsl(var(--foreground))';
      document.getElementById('applyBtn').disabled = false;
    };
    
    opsList.appendChild(btn);
  });

  // Render table
  function renderTable() {
    const tableBody = document.getElementById('dataTable');
    tableBody.innerHTML = '';
    
    sampleData.forEach((row, i) => {
      const isProcessed = processedRows.includes(i);
      const tr = document.createElement('tr');
      tr.style.cssText = `border-bottom: 1px solid hsl(var(--border) / 0.5); transition: all 0.5s; ${isProcessed ? 'background: hsl(var(--scarlet-dark) / 0.1); box-shadow: inset 0 0 20px hsl(348 83% 50% / 0.1);' : ''}`;
      tr.onmouseenter = () => { if (!isProcessed) tr.style.background = 'hsl(var(--muted) / 0.3)'; };
      tr.onmouseleave = () => { if (!isProcessed) tr.style.background = 'transparent'; };
      
      const renderCell = (value, isNull = false) => {
        if (value === null || isNull) {
          return `<span style="display: flex; align-items: center; gap: 0.25rem; color: hsl(var(--scarlet)); font-size: 0.875rem;">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
            null
          </span>`;
        }
        return value;
      };

      const statusColors = {
        active: { bg: 'hsl(142 76% 36% / 0.2)', color: 'hsl(142, 76%, 56%)' },
        inactive: { bg: 'hsl(0 84% 60% / 0.2)', color: 'hsl(0, 84%, 60%)' },
        pending: { bg: 'hsl(45 93% 47% / 0.2)', color: 'hsl(45, 93%, 58%)' },
      };
      
      tr.innerHTML = `
        <td style="padding: 0.75rem 1rem; font-family: monospace; font-size: 0.875rem; color: hsl(var(--muted-foreground));">${row.id}</td>
        <td style="padding: 0.75rem 1rem;">${row.name ? `<span style="font-family: Inter, sans-serif; font-size: 0.875rem; color: hsl(var(--foreground));">${row.name}</span>` : renderCell(null)}</td>
        <td style="padding: 0.75rem 1rem;">${row.email ? `<span style="font-family: Inter, sans-serif; font-size: 0.875rem; color: hsl(var(--muted-foreground));">${row.email}</span>` : renderCell(null)}</td>
        <td style="padding: 0.75rem 1rem;">${row.age !== null ? `<span style="font-family: monospace; font-size: 0.875rem; color: hsl(var(--muted-foreground));">${row.age}</span>` : renderCell(null)}</td>
        <td style="padding: 0.75rem 1rem;">${row.score !== null ? `<span style="font-family: monospace; font-size: 0.875rem; color: hsl(var(--muted-foreground));">${row.score}</span>` : renderCell(null)}</td>
        <td style="padding: 0.75rem 1rem;">
          <span style="padding: 0.25rem 0.5rem; border-radius: 9999px; font-size: 0.75rem; font-family: Inter, sans-serif; background: ${statusColors[row.status].bg}; color: ${statusColors[row.status].color};">${row.status}</span>
        </td>
        ${isProcessed ? `<td style="padding: 0.75rem 0.5rem;"><svg class="animate-scale-in" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="hsl(142, 76%, 56%)" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg></td>` : ''}
      `;
      
      tableBody.appendChild(tr);
    });
  }

  renderTable();

  // Apply transformation
  document.getElementById('applyBtn').onclick = () => {
    if (!selectedOp || isProcessing) return;
    
    isProcessing = true;
    processedRows = [];
    document.getElementById('applyBtnText').textContent = 'Casting Spell...';
    document.getElementById('applyBtn').disabled = true;
    
    sampleData.forEach((_, i) => {
      setTimeout(() => {
        processedRows.push(i);
        renderTable();
        if (i === sampleData.length - 1) {
          setTimeout(() => {
            isProcessing = false;
            document.getElementById('applyBtnText').textContent = 'Apply Transformation';
            document.getElementById('applyBtn').disabled = false;
          }, 500);
        }
      }, i * 200);
    });
  };
</script>
{% endblock %}
